/**
 * «Copyright 2014 José F. Maldonado»
 *
 * This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0. 
 * If a copy of the MPL was not distributed with this file, You can obtain one at http://mozilla.org/MPL/2.0/.
 */
(function(e){e.fn.jqScrollAnim=function(t){function s(t){var r=0;var i=u();var s=n.stake===null?t:n.stake;var r=o(s,n.rep,i);if(r>=1&&n.rew.start!==null&&n.rew.end!==null){r=1-o(s,n.rew,i)}if(r!==e.data(t,"last_progress")){for(var a=0;a<n.animations.length;a++){var f=n.animations[a];var l=f.start!==null?f.start:e.data(t,"css-"+f.property);var c=f.end!==null?f.end:e.data(t,"css-"+f.property);if(f.type==="custom"){f.action(t,n,r)}else if(f.type==="number"){t.css(f.property,l*(1-r)+c*r+""+f.unit)}else if(f.type==="integer"){if(c!=="out-left"&&c!=="out-right"&&l!=="out-left"&&l!=="out-right"){t.css(f.property,parseInt(l*(1-r)+c*r,10)+""+f.unit)}else{var h=e.data(t,"offset").left;var p=h;if(c==="out-left")p=-t.outerWidth();if(c==="out-right")p=e(window).width();if(l==="out-left")h=-t.outerWidth();if(l==="out-right")h=e(window).width();var d=h*(1-r)+p*r;if(f.property==="left"){var v=d-(e.data(t,"offset").left-e.data(t,"css-left"));t.css("left",parseInt(v,10)+""+f.unit)}else{var v=e.data(t,"offset").left+e.data(t,"css-right")-d;t.css("right",parseInt(v,10)+""+f.unit)}}}else if(f.type==="color"){var m=parseInt(l[0]*(1-r)+c[0]*r,10);var g=parseInt(l[1]*(1-r)+c[1]*r,10);var y=parseInt(l[2]*(1-r)+c[2]*r,10);t.css(f.property,"rgb("+m+","+g+","+y+")")}else if(f.type==="sequence"){var b=parseInt(r*(f.end.length-1));t.css(f.property,f.end[b])}}e.data(t,"last_progress",r)}}function o(e,t,n){var r=t.ref.lastIndexOf("upper-")>=0?e.offset().top:e.offset().top+e.height();var i=t.ref.lastIndexOf("-top")>=0?n.y_min:n.y_max;var s=i-r;var o=t.unit==="px"?t.start:parseInt(t.start*(n.y_max-n.y_min),10);var u=t.unit==="px"?t.end:parseInt(t.end*(n.y_max-n.y_min),10);var a=0;if(s>=o){if(s>=u){a=1}else{a=(s-o)/(u-o)}}return a}function u(){var t={x_min:0,y_min:0,x_max:0,y_max:0};t.y_min=e(document).scrollTop();t.x_min=e(document).scrollLeft();t.y_max=t.y_min+e(window).height();t.x_max=t.x_min+e(window).width();return t}function a(e){var t=[255,255,255,0];e=e.replace(/\s\s*/g,"");var n=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})/.exec(e);if(n){t=[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]}else{n=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])/.exec(e);if(n){t=[parseInt(n[1],16)*17,parseInt(n[2],16)*17,parseInt(n[3],16)*17]}else{n=/^rgba\(([\d]+),([\d]+),([\d]+),([\d]+|[\d]*.[\d]+)\)/.exec(e);if(n){t=[parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10),parseInt(n[4],10)]}else{n=/^rgb\(([\d]+),([\d]+),([\d]+)\)/.exec(e);if(n){t=[parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10)]}}}}return t}var n=e.extend({rep:{},rew:{},animations:[],stake:null},t);n.rep=e.extend({start:0,end:200,unit:"px",ref:"upper-bottom"},n.rep);n.rew=e.extend({start:null,end:null,unit:"px",ref:"base-top"},n.rew);if(n.animation!==undefined&&n.animation!==null){n.animations.push(n.animation);n.animation=null}if(n.stake!==null){n.stake=e(n.stake)}for(var r=0;r<n.animations.length;r++){var i=e.extend({type:null,property:null,start:null,end:null,unit:"",action:null},n.animations[r]);if(i.type==="integer"){if(i.unit===""||i.unit===null)i.unit="px"}if(i.type==="fade"){i.type="number";i.property="opacity";if(i.start===null)i.start=0;if(i.end===null)i.end=1}if(i.type==="move"||i.type==="move-left"||i.type==="move-right"){if(i.type==="move-left")i.start="out-left";if(i.type==="move-right")i.start="out-right";if(i.property===null)i.property="left";if(i.unit===""||i.unit===null)i.unit="px";i.type="integer"}n.animations[r]=i}return this.each(function(){var t=e(this);e.data(t,"last_progress",-1);e.data(t,"position",t.position());e.data(t,"offset",t.offset());for(var r=0;r<n.animations.length;r++){var i=n.animations[r];if(i.property!==null){var o=t.css(i.property);if(i.type==="integer")o=parseInt(o,10);if(i.type==="number")o=parseFloat(o);if(i.type==="color")o=a(o);e.data(t,"css-"+i.property,o)}n.animations[r]=i}var u=function(){s(t)};e(document).scroll(u);e(window).resize(u);u()})}})(jQuery)