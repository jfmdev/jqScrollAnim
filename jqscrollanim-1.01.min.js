/**
 * «Copyright 2014 José F. Maldonado»
 *
 * This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0. 
 * If a copy of the MPL was not distributed with this file, You can obtain one at http://mozilla.org/MPL/2.0/.
 */
(function(e){e.fn.jqScrollAnim=function(t){function s(t){var r=0;var i=u();var s=n.stake===null?t.offset().top:n.stake.offset().top;var a=o(n.rep_s,i);var f=o(n.rep_e,i);if(s<a){if(s>f){r=1-(s-f)/(a-f)}else{r=1;if(n.rew_s!==null&&n.rew_e!==null){var l=o(n.rew_s,i);var c=o(n.rew_e,i);if(s<l){if(s>c){r=(s-c)/(l-c)}else{r=0}}}}}if(t.attr("id")=="DELETE")console.log(r+" - "+e.data(t,"last_progress")+" = "+t.css(n.animations[0].property));if(r!==e.data(t,"last_progress")){for(var h=0;h<n.animations.length;h++){var p=n.animations[h];var d=p.start!==null?p.start:e.data(t,"css-"+p.property);var v=p.end!==null?p.end:e.data(t,"css-"+p.property);if(p.type==="custom"){p.action(t,n,r)}else if(p.type==="number"){t.css(p.property,d*(1-r)+v*r+""+p.unit)}else if(p.type==="integer"){if(v!=="out-left"&&v!=="out-right"&&d!=="out-left"&&d!=="out-right"){t.css(p.property,parseInt(d*(1-r)+v*r,10)+""+p.unit)}else{var m=e.data(t,"offset").left;var g=m;if(v==="out-left")g=-t.outerWidth();if(v==="out-right")g=e(window).width();if(d==="out-left")m=-t.outerWidth();if(d==="out-right")m=e(window).width();var y=m*(1-r)+g*r;if(p.property==="left"){var b=y-(e.data(t,"offset").left-e.data(t,"css-left"));t.css("left",parseInt(b,10)+""+p.unit)}else{var b=e.data(t,"offset").left+e.data(t,"css-right")-y;t.css("right",parseInt(b,10)+""+p.unit)}}}else if(p.type==="color"){var w=parseInt(d[0]*(1-r)+v[0]*r,10);var E=parseInt(d[1]*(1-r)+v[1]*r,10);var S=parseInt(d[2]*(1-r)+v[2]*r,10);t.css(p.property,"rgb("+w+","+E+","+S+")")}else if(p.type==="sequence"){var x=parseInt(r*(p.end.length-1));t.css(p.property,p.end[x])}}if(t.attr("id")=="DELETE")console.log("           = "+t.css(n.animations[0].property));e.data(t,"last_progress",r)}}function o(e,t){if(e>0&&e<1||e>-1&&e<0){e=parseInt(e*(t.y_max-t.y_min),10)}return e>=0?t.y_max-e:t.y_min-e}function u(){var t={x_min:0,y_min:0,x_max:0,y_max:0};t.y_min=e(document).scrollTop();t.x_min=e(document).scrollLeft();t.y_max=t.y_min+e(window).height();t.x_max=t.x_min+e(window).width();return t}function a(e){var t=[255,255,255,0];e=e.replace(/\s\s*/g,"");var n=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})/.exec(e);if(n){t=[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]}else{n=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])/.exec(e);if(n){t=[parseInt(n[1],16)*17,parseInt(n[2],16)*17,parseInt(n[3],16)*17]}else{n=/^rgba\(([\d]+),([\d]+),([\d]+),([\d]+|[\d]*.[\d]+)\)/.exec(e);if(n){t=[parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10),parseInt(n[4],10)]}else{n=/^rgb\(([\d]+),([\d]+),([\d]+)\)/.exec(e);if(n){t=[parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10)]}}}}return t}var n=e.extend({rep_s:0,rep_e:200,rew_s:null,rew_e:null,animations:[],stake:null},t);if(n.animation!==undefined&&n.animation!==null){n.animations.push(n.animation);n.animation=null}if(n.stake!==null){n.stake=e(n.stake)}for(var r=0;r<n.animations.length;r++){var i=e.extend({type:null,property:null,start:null,end:null,unit:"",action:null},n.animations[r]);if(i.type==="integer"){if(i.unit===""||i.unit===null)i.unit="px"}if(i.type==="fade"){i.type="number";i.property="opacity";if(i.start===null)i.start=0;if(i.end===null)i.end=1}if(i.type==="move"||i.type==="move-left"||i.type==="move-right"){if(i.type==="move-left")i.start="out-left";if(i.type==="move-right")i.start="out-right";if(i.property===null)i.property="left";if(i.unit===""||i.unit===null)i.unit="px";i.type="integer"}n.animations[r]=i}return this.each(function(){var t=e(this);e.data(t,"last_progress",-1);e.data(t,"position",t.position());e.data(t,"offset",t.offset());for(var r=0;r<n.animations.length;r++){var i=n.animations[r];if(i.property!==null){var o=t.css(i.property);if(i.type==="integer")o=parseInt(o,10);if(i.type==="number")o=parseFloat(o);if(i.type==="color")o=a(o);e.data(t,"css-"+i.property,o)}n.animations[r]=i}var u=function(){s(t)};e(document).scroll(u);e(window).resize(u);u()})}})(jQuery)